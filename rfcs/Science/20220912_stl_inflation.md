# 为 PaddleScience 2D 非定常圆柱绕流案例进行训练过程动力学行为进行分析

|                                                                |                                                         |
| -------------------------------------------------------------- | ------------------------------------------------------- |
| 提交作者<input type="checkbox" class="rowselector hidden">     | PuQing                                                  |
| 提交时间<input type="checkbox" class="rowselector hidden">     | 2022-09-12                                              |
| 版本号                                                         | V1.0                                                    |
| 依赖飞桨版本<input type="checkbox" class="rowselector hidden"> | develop                                                 |
| 文件名                                                         | 20220912_stl_inflation.md |

## 一、概述

对外部导入的几何文件进行法向外扩采样

## 二、设计思路与实现方案

一个几何体可以由顶点，以及三角面构成。为了便于考虑，我们先考虑如下几何体：

![968aece2e065f3f8a426228db6a6a88a52ccf869bcd1cb5b.png](https://images.puqing.work/968aece2e065f3f8a426228db6a6a88a52ccf869bcd1cb5b.png)

原有几何体为实线组成，虚线为外扩几何体，对于原三角面上的点$v_1$, 我们需要知道外扩$d$距离后，该点的位置，即$v'_1$。

已知与$v_1$相邻的三角面的法向量为$\vec{n}_1$、$\vec{n}_2$、$\vec{n}_3$，则可表达出外扩后分别对应的三角面为：

$$
\vec{n}_1 \times (v-v_1) + d = 0 \\
\vec{n}_2 \times (v-v_1) + d = 0 \\
\vec{n}_3 \times (v-v_1) + d = 0
$$

他们的交点即为$v'_1$， 通过求解上述方程组，即可得到$v'_1$。

另外，上述方程组有解的前提是 $Rank([\vec{n}_1、\vec{n}_2、\vec{n}_3])=3$ 即要求三个向量线性无关，否则无解。

我们对几何体中所有点做上述外扩即得到外扩后的图形，之后再做三角面采样即可。

### 特别的

在实际编写中发现有些稍微复杂几何体，存在如下情况：

- 点的近邻三角面小于3个，即无法构成方程组（做去除处理）
- 点的近邻三角面大于3个，这时存在多种情况
  - 任意三个三角面的组合的解相同
  - 各种组合的解各不相同（取到各面最接近$d$的点）
- 外扩后存在三角面之间相交的情况，这时需要对三角面做合并或者简化处理

所以利用法向量进行外扩对网格本身质量有一定要求，对于一些复杂的网格，需要先做一些处理，如：

- 删除重复点
- 删除重复三角面
- 删除退化三角面

## 三、测试和验收的考量

给定任意简单凸几何体应可以得到外扩一定距离后得到的采样点。

## 四、可行性分析和排期规划

可在当前任务时间内完成

## 五、一些效果图

![2022-09-12-21.38.006a31059abe3de317.png](https://images.puqing.work/2022-09-12-21.38.006a31059abe3de317.png)

![2022-09-12-21.40.4546f9dee5d74af35f.png](https://images.puqing.work/2022-09-12-21.40.4546f9dee5d74af35f.png)
