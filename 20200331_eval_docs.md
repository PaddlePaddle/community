# 飞桨动态图训练功能体验方案

| 领域                                                         | 飞桨动态图训练功能体验方案 |
| ------------------------------------------------------------ | -------------------------- |
| 提交作者<input type="checkbox" class="rowselector hidden">   | 王源 袁闯闯                |
| 提交时间<input type="checkbox" class="rowselector hidden">   | 2022-03-31                 |
| 版本号                                                       | V1.0                       |
| 依赖飞桨版本<input type="checkbox" class="rowselector hidden"> | paddlepaddle-gpu==2.2      |
| 文件名                                                       | 20200331_eval_docs.md<br>  |


# 一、概述
## 1、相关背景

飞桨框架于 2.0 正式版全面支持了动态图训练，并在2.1、2.2 两个大版本中不断新增了API以及大幅增强了训练功能。

希望有人对于飞桨框架动态图下单机训练功能整体的使用感受，可以与其他深度学习框架做功能对比，包括API、Tensor 索引、NumPy Compatibility、报错信息提示、训练性能、以及各种 trick 的用法等，并产出一份对应的评估报告。

## 2、功能目标

深度体验飞桨动态图训练功能，并产出一份文档功能评估报告。主要关注该功能 Paddle 的使用体验。

## 3、意义

从用户角度认为的该功能比较好的使用体验和该功能 Paddle 的使用体验，以及两者之间的使用体验对比，包括易用性、完整性、前瞻性等。

# 二、飞桨现状

飞桨从 [2.0.0](https://github.com/PaddlePaddle/Paddle/releases/tag/v2.0.0) 从 1.x 到 2.0 做了较大的功能更新。

从编程范式上说，飞桨兼容支持声明式编程和命令式编程，通俗地讲即静态图和动态图。其实飞桨本没有图的概念，在飞桨的设计中，把一个神经网络定义成一段类似程序的描述，也就是用户在写程序的过程中，就定义了模型表达及计算。

在静态图的控制流实现方面，飞桨借助自己实现的控制流OP而不是python原生的if else和for循环，这使得在飞桨中的定义的program即一个网络模型，可以有一个内部的表达，是可以全局优化编译执行的。

考虑对开发者来讲，更愿意使用python原生控制流，飞桨也做了支持，并通过解释方式执行，这就是动态图。但整体上，这两种编程范式是相对兼容统一的。飞桨将持续发布更完善的动态图功能，同时保持更强劲的性能。

# 三、业内方案调研

经查阅资料，国内外主流框架文档、官方网站及其功能分类罗列如下：

PyTorch：[PyTorch](https://pytorch.org/docs/stable/index.html) 主要分为 tutorial 和 API 两个分类。

TensorFlow：[TF 文档](https://www.tensorflow.org/overview) 主要分为 learn、tutorial、guide、API 四个分类。

飞桨： [Paddle](https://www.paddlepaddle.org.cn/documentation/docs/zh/guides/index_cn.html) 主要分为 使用指南、应用实践、API 与 FAQ 四个分类。

MindSpore： [MindSpore](https://www.mindspore.cn/lite) 主要包括了教程、文档、API 三个分类。

# 四、对比分析

PyTorch 是一个动态的深度学习框架，目前的文档丰富，且积累了大量的官方、第三方的学习资料。

TensorFlow 最早方便地、较完备地实现了模型预研、训练到工业部署的问题，在此方面积累了丰富的基础组件和用户群体。不过在 API 设计方面，TensorFlow 由于各种原因导致的 API 功能重复、概念复杂，降低了用户体验感受，同时也间接影响到了文档结构的清晰。

其它的主流深度学习框架，都或多或少受到 TensorFlow 与 PyTorch 的影响。

总结而言，影响用户体验的动态图训练功能可以归为以下几个方面：

解析式的执行方式。用户无需预先定义完整的网络结构，每写一行网络代码，即可同时获得计算结果。

代码运行完成后，可以立马获取结果，支持使用 IDE 断点调试功能，使得调试更方便。

属于命令式的编程方式，与编写Python的方式类似，更容易上手。

网络的结构在不同的层次中可以变化，使用更灵活。


# 五、设计思路与实现方案

评估报告设计思路包括如下几部分：

1、如何开启动态图模式

2、如何使用动态图进行模型训练

3、如何基于动态图进行多卡训练

4、如何部署动态图模型

评估报告实现方案包括如下几部分：

动态图模式常见的使用技巧，如：
1、中间变量值/梯度打印
2、断点调试
3、阻断反向传递
4、以及某些场景下如何改写为静态图模式运行。

通过实验分析飞桨动态图训练功能的易用性、完整性、前瞻性等

## 命名与参数设计

因为是评估报告，没有 API 接口设计，无需命名与参数设计

# 六、测试和验收的考量

通过深度体验飞桨动态图训练功能，提交一份评估报告。具体考量标准和方式以飞桨 RFC 中讨论为准，但至少应包含存在较好使用体验的内容点、存在不足及改进建议。

# 七、可行性分析和排期规划

对各主流深度学习框架已经有一定基础和研究，需要进一步做细致的体验测试及分析，最终形成详细的评估报告。

预计整个工作在一个月内可以完成，最晚不会晚于黑客松设定的验收时间。


# 八、影响面

无

# 名词解释

无

# 附件及参考资料

飞桨大量的官方文档、网站等学习资料